<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Invoice</title>

    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: Arial, Helvetica, sans-serif;
      }

      body {
        background: #fff;
        color: #111827;
        font-size: 12px; /* ðŸ”½ font thoda chhota */
        line-height: 1.4; /* ðŸ”½ line-height kam */
      }

      .invoice-page {
        width: 100%;
        padding: 16px; /* ðŸ”½ overall padding kam */
        position: relative;
      }

      .bg-watermark {
        position: absolute;
        top: 22%;
        left: 50%;
        transform: translate(-50%, -50%) rotate(-15deg);
        font-size: 60px; /* ðŸ”½ */
        color: rgba(0, 0, 0, 0.04);
        font-weight: 700;
      }

      .paid-watermark {
        position: absolute;
        top: 42%;
        left: 50%;
        transform: translate(-50%, -50%) rotate(-15deg);
        font-size: 90px; /* ðŸ”½ */
        color: rgba(0, 0, 0, 0.08);
        font-weight: 700;
      }

      .invoice-header {
        display: flex;
        justify-content: space-between;
        border-bottom: 2px solid #1e3a8a; /* ðŸ”½ */
        padding-bottom: 8px;
        margin-bottom: 10px;
      }

      .header-left img {
        height: 60px; /* ðŸ”½ */
      }

      .header-right {
        font-size: 20px; /* ðŸ”½ */
        font-weight: 700;
        color: #1e3a8a;
      }

      .invoice-meta {
        display: flex;
        justify-content: space-between;
        margin-bottom: 6px; /* ðŸ”½ */
      }

      .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px; /* ðŸ”½ */
        margin-bottom: 10px;
      }

      .info-title {
        font-weight: 700;
        color: #1e3a8a;
        margin-bottom: 4px; /* ðŸ”½ */
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 10px; /* ðŸ”½ */
      }

      th {
        background: #1e3a8a;
        color: #fff;
        padding: 6px; /* ðŸ”½ */
        font-size: 12px;
      }

      td {
        padding: 6px; /* ðŸ”½ */
        border-bottom: 1px solid #e5e7eb;
      }

      td:last-child {
        text-align: right;
      }

      .comments {
        margin-top: 10px; /* ðŸ”½ */
        font-size: 11px; /* ðŸ”½ */
      }

      .summary-wrapper {
        display: flex;
        justify-content: flex-end;
        margin-top: 8px; /* ðŸ”½ */
      }

      .summary-box {
        width: 300px; /* ðŸ”½ */
        border: 1px solid #e5e7eb;
        padding: 10px; /* ðŸ”½ */
      }

      .summary-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 4px; /* ðŸ”½ */
      }

      .summary-row.total {
        font-weight: 700;
        font-size: 13px;
        border-top: 2px solid #1e3a8a;
        padding-top: 6px;
        margin-top: 6px;
      }

      .invoice-footer {
        margin-top: 14px; /* ðŸ”½ */
        text-align: center;
        font-size: 11px;
        color: #374151;
        border-top: 1px solid #e5e7eb;
        padding-top: 6px;
      }
    </style>
  </head>

  <body>
    <% const subTotal = invoice.courses.reduce( (sum, c) => sum +
    Number(c.amount || 0), 0 ); const cgst = Number(invoice.taxes?.cgst || 0);
    const sgst = Number(invoice.taxes?.sgst || 0); const igst =
    Number(invoice.taxes?.igst || 0); const otherTaxes =
    Number(invoice.taxes?.otherTaxes || 0); const discount =
    Number(invoice.discount || 0); const totalAmount = subTotal + cgst + sgst +
    igst + otherTaxes - discount; const paidAmount = Number(invoice.paidAmount
    || 0); const dueAmount = Math.max(totalAmount - paidAmount, 0); const
    dueDate = new Date(invoice.createdAt); dueDate.setDate(dueDate.getDate() +
    30); %>

    <div class="invoice-page">
      <div class="bg-watermark">XYNAPSE</div>

      <% if (dueAmount === 0) { %>
      <div class="paid-watermark">PAID</div>
      <% } %>

      <div class="invoice-header">
        <div class="header-left">
          <img src="<%= logoBase64 %>" />
        </div>
        <div class="header-right">RECEIPT</div>
      </div>

      <div class="invoice-meta">
        <div><strong>INVOICE #</strong> <%= invoice.invoiceNumber %></div>
        <div>
          <strong>DATE</strong> <%= new Date(invoice.createdAt).toDateString()
          %>
        </div>
      </div>

      <div class="invoice-meta">
        <div><strong>DUE DATE</strong> <%= dueDate.toDateString() %></div>
      </div>

      <div class="info-grid">
        <div>
          <div class="info-title">MAILING INFO</div>
          Xynapes Systems Institute<br />
          Whitefield, Bengaluru<br />
          Phone: 7081140055
        </div>

        <div>
          <div class="info-title">STUDENT DETAILS</div>
          <strong><%= student.name %></strong><br />
          Phone: <%= student.mobile %><br />
          Mode: <%= invoice.paymentMode %>
        </div>
      </div>

      <table>
        <thead>
          <tr>
            <th>COURSE</th>
            <th>INSTRUCTOR</th>
            <th>AMOUNT</th>
          </tr>
        </thead>
        <tbody>
          <% invoice.courses.forEach(c => { %>
          <tr>
            <td><%= c.course?.title || "-" %></td>
            <td><%= c.instructor?.name || "-" %></td>
            <td>â‚¹<%= Number(c.amount).toFixed(2) %></td>
          </tr>
          <% }) %>
        </tbody>
      </table>

      <div class="comments">
        <strong>OTHER COMMENTS / TAX RATE 18%</strong><br /><br />

        <strong>Xynapse Systems Institute â€“ Terms & Conditions</strong
        ><br /><br />

        <strong>1. Payment & Refund Policy</strong><br />
        Once the course payment is made, it is strictly non-refundable under any
        circumstances. However, students may choose to enroll in another course
        within one month of the original payment. After this period, no further
        assistance will be provided.<br /><br />

        <strong>2. Trainer Change Policy</strong><br />
        Requests for a trainer change will be accepted only within the first 1
        or 2 classes. Requests made after attending several classes will be
        difficult to accommodate, as the trainer payment is processed in
        advance. In such cases, the course must be completed with the same
        trainer.<br /><br />

        <strong>3. Payment Structure</strong><br />
        Course fees are to be paid in a one-time payment. Any due amount must be
        cleared within 30 days, with a maximum of two installments allowed.<br /><br />

        <strong>4. Class Schedule</strong><br />
        Weekdays: 1 hour per session<br />
        Weekends: 2 hours per session<br />
        Students must choose only one option (weekday or weekend); both cannot
        be selected.<br /><br />

        <strong>4. Mode of Training</strong><br />
        All classes will be conducted in online mode. Trainers are professional
        and experienced.
      </div>

      <div class="summary-wrapper">
        <div class="summary-box">
          <div class="summary-row">
            <span>SUBTOTAL</span><span>â‚¹<%= subTotal.toFixed(2) %></span>
          </div>
          <div class="summary-row">
            <span>CGST</span><span>â‚¹<%= cgst.toFixed(2) %></span>
          </div>
          <div class="summary-row">
            <span>SGST</span><span>â‚¹<%= sgst.toFixed(2) %></span>
          </div>
          <div class="summary-row">
            <span>IGST</span><span>â‚¹<%= igst.toFixed(2) %></span>
          </div>
          <div class="summary-row">
            <span>OTHER TAXES</span><span>â‚¹<%= otherTaxes.toFixed(2) %></span>
          </div>
          <div class="summary-row">
            <span>DISCOUNT</span><span>-â‚¹<%= discount.toFixed(2) %></span>
          </div>

          <div class="summary-row total">
            <span>TOTAL AMOUNT</span>
            <span>â‚¹<%= totalAmount.toFixed(2) %></span>
          </div>

          <div class="summary-row">
            <span>PAID AMOUNT</span>
            <span>â‚¹<%= paidAmount.toFixed(2) %></span>
          </div>

          <div class="summary-row total">
            <span>DUE AMOUNT</span>
            <span>â‚¹<%= dueAmount.toFixed(2) %></span>
          </div>
        </div>
      </div>

      <div class="invoice-footer">
        XYNAPSE SYSTEM Â© <%= new Date().getFullYear() %>
      </div>
    </div>
  </body>
</html>
